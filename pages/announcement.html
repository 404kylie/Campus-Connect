<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CampusConnect Portal</title>
    <link rel="stylesheet" href="chat.css" />
  </head>

  <body>
    <header>
      <div class="logo-title">
        <img
          src="https://static.vecteezy.com/system/resources/previews/032/414/564/original/3d-rendering-of-speech-bubble-3d-pastel-chat-with-question-mark-icon-set-png.png"
          alt="Logo"
          class="logo"
        />
        <span class="app-title">CampusConnect</span>
      </div>
    </header>

    <div class="dashboard-container">
      <aside class="sidebar">
        <ul>
          <li><a href="student_dashboard.php">🏠 Project Overview</a></li>
          <li><a href="announcement.php">📢 Announcements</a></li>
          <li><a href="chat.php">💬 Chat Support</a></li>
          <li><a href="manage-account.php">👤 My Account</a></li>
          <li><a href="logout.php">🚪 Logout</a></li>
        </ul>
      </aside>

      <main class="content">
        <section class="section" id="announcements">
          <h1>📢 Latest Announcements</h1>

          <?php if (isset($_SESSION['is_admin']) && $_SESSION['is_admin']): ?>
          <form method="POST" class="admin-form">
            <textarea
              name="new_announcement"
              rows="3"
              placeholder="Write a new announcement..."
            ></textarea>
            <button type="submit">Add Announcement</button>
          </form>
          <?php endif; ?>

          <div id="announcement-list">
            <!-- Fetched dynamically by JS -->
          </div>
        </section>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        fetch("get_announcements.php")
          .then((response) => response.json())
          .then((data) => {
            const list = document.getElementById("announcement-list");
            list.innerHTML = "";

            if (data.length === 0) {
              list.innerHTML = "<p>No announcements at the moment.</p>";
              return;
            }

            data.forEach((item) => {
              const container = document.createElement("div");
              container.classList.add("announcement-item");

              const date = new Date(item.created_at);
              const formattedDate = date.toLocaleString();

              container.innerHTML = `
              <div class="announcement-title">📢 Announcement</div>
              <div class="announcement-date">${formattedDate}</div>
              <div class="announcement-description">${item.content}</div>
            `;

              list.appendChild(container);
            });
          })
          .catch((error) => {
            console.error("Error loading announcements:", error);
          });
      });
    </script>
  </body>
</html>
